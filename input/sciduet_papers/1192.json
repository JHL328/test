{"title": "Towards String-to-Tree Neural Machine Translation", "abstract": "We present a simple method to incorporate syntactic information about the target language in a neural machine translation system by translating into linearized, lexicalized constituency trees. Experiments on the WMT16 German-English news translation task shown improved BLEU scores when compared to a syntax-agnostic NMT baseline trained on the same dataset. An analysis of the translations from the syntax-aware system shows that it performs more reordering during translation in comparison to the baseline. A smallscale human evaluation also showed an advantage to the syntax-aware system.", "text": [{"id": 0, "string": "Introduction and Model Neural Machine Translation (NMT) (Kalchbrenner and Blunsom, 2013; Sutskever et al., 2014; Bahdanau et al., 2014) has recently became the state-of-the-art approach to machine translation (Bojar et al., 2016) , while being much simpler than the previously dominant phrase-based statistical machine translation (SMT) approaches (Koehn, 2010) ."}, {"id": 1, "string": "NMT models usually do not make explicit use of syntactic information about the languages at hand."}, {"id": 2, "string": "However, a large body of work was dedicated to syntax-based SMT (Williams et al., 2016) ."}, {"id": 3, "string": "One prominent approach to syntaxbased SMT is string-to-tree (S2T) translation Knight, 2001, 2002) , in which a sourcelanguage string is translated into a target-language tree."}, {"id": 4, "string": "S2T approaches to SMT help to ensure the resulting translations have valid syntactic structure, while also mediating flexible reordering between the source and target languages."}, {"id": 5, "string": "The main formalism driving current S2T SMT systems is GHKM rules (Galley et al., 2004 (Galley et al., , 2006 , which are synchronous transduction grammar (STSG) fragments, extracted from word-aligned sentence pairs with syntactic trees on one side."}, {"id": 6, "string": "The GHKM translation rules allow flexible reordering on all levels of the parse-tree."}, {"id": 7, "string": "We suggest that NMT can also benefit from the incorporation of syntactic knowledge, and propose a simple method of performing string-to-tree neural machine translation."}, {"id": 8, "string": "Our method is inspired by recent works in syntactic parsing, which model trees as sequences Choe and Charniak, 2016) ."}, {"id": 9, "string": "Namely, we translate a source sentence into a linearized, lexicalized constituency tree, as demonstrated in Figure 2 ."}, {"id": 10, "string": "Figure 1 shows a translation from our neural S2T model compared to one from a vanilla NMT model for the same source sentence, as well as the attention-induced word alignments of the two models."}, {"id": 11, "string": "Figure 1 : Top -a lexicalized tree translation predicted by the bpe2tree model."}, {"id": 12, "string": "Bottom -a translation for the same sentence from the bpe2bpe model."}, {"id": 13, "string": "The blue lines are drawn according to the attention weights predicted by each model."}, {"id": 14, "string": "Note that the linearized trees we predict are different in their structure from those in  as instead of having part of speech tags as terminals, they contain the words of the translated sentence."}, {"id": 15, "string": "We intentionally omit the POS informa-Jane hatte eine Katze ."}, {"id": 16, "string": "\u2192 ( ROOT ( S ( N P Jane ) N P ( V P had ( N P a cat ) N P ) V P . )"}, {"id": 17, "string": "S ) ROOT Figure 2 : An example of a translation from a string to a linearized, lexicalized constituency tree."}, {"id": 18, "string": "tion as including it would result in significantly longer sequences."}, {"id": 19, "string": "The S2T model is trained on parallel corpora in which the target sentences are automatically parsed."}, {"id": 20, "string": "Since this modeling keeps the form of a sequence-to-sequence learning task, we can employ the conventional attention-based sequence to sequence paradigm (Bahdanau et al., 2014) as-is, while enriching the output with syntactic information."}, {"id": 21, "string": "Related Work Some recent works did propose to incorporate syntactic or other linguistic knowledge into NMT systems, although mainly on the source side: Eriguchi et al."}, {"id": 22, "string": "(2016a,b) replace the encoder in an attention-based model with a Tree-LSTM (Tai et al., 2015) over a constituency parse tree; Bastings et al."}, {"id": 23, "string": "(2017) encoded sentences using graph-convolutional networks over dependency trees; Sennrich and Haddow (2016) proposed a factored NMT approach, where each source word embedding is concatenated to embeddings of linguistic features of the word; Luong et al."}, {"id": 24, "string": "(2015) incorporated syntactic knowledge via multi-task sequence to sequence learning: their system included a single encoder with multiple decoders, one of which attempts to predict the parse-tree of the source sentence; Stahlberg et al."}, {"id": 25, "string": "(2016) proposed a hybrid approach in which translations are scored by combining scores from an NMT system with scores from a Hiero (Chiang, 2005 (Chiang, , 2007 system."}, {"id": 26, "string": "Shi et al."}, {"id": 27, "string": "(2016) explored the syntactic knowledge encoded by an NMT encoder, showing the encoded vector can be used to predict syntactic information like constituency trees, voice and tense with high accuracy."}, {"id": 28, "string": "In parallel and highly related to our work, Eriguchi et al."}, {"id": 29, "string": "(2017) proposed to model the target syntax in NMT in the form of dependency trees by using an RNNG-based decoder (Dyer et al., 2016) , while Nadejde et al."}, {"id": 30, "string": "(2017) incorporated target syntax by predicting CCG tags serialized into the target translation."}, {"id": 31, "string": "Our work differs from those by modeling syntax using constituency trees, as was previously common in the \"traditional\" syntaxbased machine translation literature."}, {"id": 32, "string": "Experiments & Results Experimental Setup We first experiment in a resource-rich setting by using the German-English portion of the WMT16 news translation task (Bojar et al., 2016) , with 4.5 million sentence pairs."}, {"id": 33, "string": "We then experiment in a low-resource scenario using the German, Russian and Czech to English training data from the News Commentary v8 corpus, following Eriguchi et al."}, {"id": 34, "string": "(2017) ."}, {"id": 35, "string": "In all cases we parse the English sentences into constituency trees using the BLLIP parser (Charniak and Johnson, 2005) ."}, {"id": 36, "string": "1 To enable an open vocabulary translation we used sub-word units obtained via BPE (Sennrich et al., 2016b) on both source and target."}, {"id": 37, "string": "2 In each experiment we train two models."}, {"id": 38, "string": "A baseline model (bpe2bpe), trained to translate from the source language sentences to English sentences without any syntactic annotation, and a string-to-linearized-tree model (bpe2tree), trained to translate into English linearized constituency trees as shown in Figure 2 ."}, {"id": 39, "string": "Words are segmented into sub-word units using the BPE model we learn on the raw parallel data."}, {"id": 40, "string": "We use the NEMATUS  3 implementation of an attention-based NMT model."}, {"id": 41, "string": "4 We trained the models until there was no improvement on the development set in 10 consecutive checkpoints."}, {"id": 42, "string": "Note that the only difference between the baseline and the bpe2tree model is the syntactic information, as they have a nearly-identical amount of model parameters (the only additional parameters to the syntax-aware system are the embeddings for the brackets of the trees)."}, {"id": 43, "string": "For all models we report results of the best performing single model on the dev-set (new-stest2013+newstest2014 in the resource rich setting, newstest2015 in the rest, as measured by BLEU) when translating newstest2015 and new-stest2016, similarly to Sennrich et al."}, {"id": 44, "string": "(2016a) ; Eriguchi et al."}, {"id": 45, "string": "(2017) ."}, {"id": 46, "string": "To evaluate the string-totree translations we derive the surface form by removing the symbols that stand for non-terminals in the tree, followed by merging the sub-words."}, {"id": 47, "string": "We also report the results of an ensemble of the last 5 checkpoints saved during each model training."}, {"id": 48, "string": "We compute BLEU scores using the mteval-v13a.pl script from the Moses toolkit (Koehn et al., 2007) ."}, {"id": 49, "string": "Results As shown in Table 1 , for the resource-rich setting, the single models (bpe2bpe, bpe2tree) perform similarly in terms of BLEU on newstest2015."}, {"id": 50, "string": "On newstest2016 we witness an advantage to the bpe2tree model."}, {"id": 51, "string": "A similar trend is found when evaluating the model ensembles: while they improve results for both models, we again see an advantage to the bpe2tree model on newstest2016."}, {"id": 52, "string": "Table 2 shows the results in the low-resource setting, where the bpe2tree model is consistently better than the bpe2bpe baseline."}, {"id": 53, "string": "We find this interesting as the syntax-aware system performs a much harder task (predicting trees on top of the translations, thus handling much longer output sequences) while having a nearly-identical amount of model parameters."}, {"id": 54, "string": "In order to better understand where or how the syntactic information improves translation quality, we perform a closer analysis of the WMT16 experiment."}, {"id": 55, "string": "Analysis The Resulting Trees Our model produced valid trees for 5970 out of 6003 sentences in the development set."}, {"id": 56, "string": "While we did not perform an in-depth error-analysis, the trees seem to follow the syntax of English, and most choices seem reasonable."}, {"id": 57, "string": "Quantifying Reordering English and German differ in word order, requiring a significant amount of reordering to generate a fluent translation."}, {"id": 58, "string": "A major benefit of S2T models in SMT is facilitating reordering."}, {"id": 59, "string": "Does this also hold for our neural S2T model?"}, {"id": 60, "string": "We compare the amount of reordering in the bpe2bpe and bpe2tree models using a distortion score based on the alignments derived from the attention weights of the corresponding systems."}, {"id": 61, "string": "We first convert the attention weights to hard alignments by taking for each target word the source word with highest attention weight."}, {"id": 62, "string": "For an n-word target sentence t and source sentence s let a(i) be the position of the source word aligned to the target word in position i."}, {"id": 63, "string": "We define: d(s, t) = 1 n n i=2 |a(i) \u2212 a(i \u2212 1)| For example, for the translations in Figure 1 , the above score for the bpe2tree model is 2.73, while the score for the bpe2bpe model is 1.27 as the bpe2tree model did more reordering."}, {"id": 64, "string": "Note that for the bpe2tree model we compute the score only on tokens which correspond to terminals (words or sub-words) in the tree."}, {"id": 65, "string": "We compute this score for each source-target pair on newstest2015 for each model."}, {"id": 66, "string": "Figure 3 shows a histogram of the binned score counts."}, {"id": 67, "string": "The bpe2tree model has more translations with distortion scores in bins 1onward and significantly less translations in the least-reordering bin (0) when compared to the bpe2bpe model, indicating that the syntactic information encouraged the model to perform more reordering."}, {"id": 68, "string": "5 Figure 4 tracks the distortion scores throughout the learning process, plotting the average dev-set scores for the model checkpoints saved every 30k updates."}, {"id": 69, "string": "Interestingly, both models obey to the following trend: open with a relatively high distortion score, followed by a steep decrease, and from there ascend gradually."}, {"id": 70, "string": "The bpe2tree model usually has a higher distortion score during training, as we would expect after our previous findings from Figure 3 ."}, {"id": 71, "string": "Tying Reordering and Syntax The bpe2tree model generates translations with their constituency tree and their attention-derived alignments."}, {"id": 72, "string": "We can use this information to extract GHKM rules (Galley et al., 2004) ."}, {"id": 73, "string": "6 We derive Table 4 : Translation examples from newstest2015."}, {"id": 74, "string": "The underlines correspond to the source word attended by the first opening bracket (these are consistently the main verbs or structural markers) and the target words this source word was most strongly aligned to."}, {"id": 75, "string": "See the supplementary material for an attention weight matrix example when predicting a tree ( Figure 6 ) and additional output examples."}, {"id": 76, "string": "hard alignments for that purpose by treating every source/target token-pair with attention score above 0.5 as an alignment."}, {"id": 77, "string": "Extracting rules from the dev-set predictions resulted in 233,657 rules, where 22,914 of them (9.8%) included reordering, i.e."}, {"id": 78, "string": "contained variables ordered differently in the source and the target."}, {"id": 79, "string": "We grouped the rules by their LHS (corresponding to a target syntactic structure), and sorted them by the total number of RHS (corresponding to a source sequential structure) with reordering."}, {"id": 80, "string": "Table 3 shows the top 10 extracted LHS, together with the top-5 RHS, for each rule."}, {"id": 81, "string": "The most common rule, VP(x 0 :TER x 1 :NP) \u2192 x 1 x 0 , found in 184 sentences in the dev set (8.4%), is indicating that the sequence x 1 x 0 in German was reordered to form a verb phrase in English, in which x 0 is a terminal and x 1 is a noun phrase."}, {"id": 82, "string": "The extracted GHKM rules reveal very sensible German-English reordering patterns."}, {"id": 83, "string": "Relative Constructions Browsing the produced trees hints at a tendency of the syntax-aware model to favor using relative-clause structures and subordination over other syntactic constructions (i.e., \"several cameras that are all priced...\" vs. \"several cameras, all priced...\")."}, {"id": 84, "string": "To quantify this, we count the English relative pronouns (who, which, that 7 , whom, whose) found in the newstest2015 translations of each model and in the reference translations, as shown in Figure 5 ."}, {"id": 85, "string": "The bpe2tree model produces more relative constructions compared to the bpe2bpe model, and both models produce more such constructions than found in the reference."}, {"id": 86, "string": "Main Verbs While not discussed until this point, the generated opening and closing brackets also have attention weights, providing another opportunity to to peak into the model's behavior."}, {"id": 87, "string": "Figure 6 in the supplementary material presents an example of a complete attention matrix, including the syntactic brackets."}, {"id": 88, "string": "While making full sense of the attention patterns of the syntactic elements remains a challenge, one clear trend is that opening the very first bracket of the sentence consistently attends to the main verb or to structural markers (i.e."}, {"id": 89, "string": "question marks, hyphens) in the source sentence, suggesting a planning-ahead behavior of the decoder."}, {"id": 90, "string": "The underlines in Table 4 correspond to the source word attended by the first opening bracket, and the target word this source word was most strongly aligned to."}, {"id": 91, "string": "In general, we find the alignments from the syntax-based system more sensible (i.e."}, {"id": 92, "string": "in Figure 1 -the bpe2bpe alignments are off-by-1)."}, {"id": 93, "string": "Qualitative Analysis and Human Evaluations The bpe2tree translations read better than their bpe2bpe counterparts, both syntactically and semantically, and we highlight some examples which demonstrate this."}, {"id": 94, "string": "Table 4 lists some representative examples, highlighting improvements that correspond to syntactic phenomena involving reordering or global structure."}, {"id": 95, "string": "We also performed a small-scale human-evaluation using mechanical turk on the first 500 sentences in the dev-set."}, {"id": 96, "string": "Further details are available in the supplementary material."}, {"id": 97, "string": "The results are summarized in the following table: 2bpe weakly better 100 2bpe strongly better 54 2tree weakly better 122 2tree strongly better 64 both good 26 both bad 3 disagree 131 As can be seen, in 186 cases (37.2%) the human evaluators preferred the bpe2tree translations, vs. 154 cases (30.8%) for bpe2bpe, with the rest of the cases (30%) being neutral."}, {"id": 98, "string": "Conclusions and Future Work We present a simple string-to-tree neural translation model, and show it produces results which are better than those of a neural string-to-string model."}, {"id": 99, "string": "While this work shows syntactic information about the target side can be beneficial for NMT, this paper only scratches the surface with what can be done on the subject."}, {"id": 100, "string": "First, better models can be proposed to alleviate the long sequence problem in the linearized approach or allow a more natural tree decoding scheme (Alvarez-Melis and Jaakkola, 2017) ."}, {"id": 101, "string": "Comparing our approach to other syntax aware NMT models like Eriguchi et al."}, {"id": 102, "string": "(2017) and Nadejde et al."}, {"id": 103, "string": "(2017) may also be of interest."}, {"id": 104, "string": "A Contrastive evaluation (Sennrich, 2016) of a syntax-aware system vs. a syntax-agnostic system may also shed light on the benefits of incorporating syntax into NMT."}, {"id": 105, "string": "A Supplementary Material Data The English side of the corpus was tokenized (into Penn treebank format) and truecased using the scripts provided in Moses (Koehn et al., 2007) ."}, {"id": 106, "string": "We ran the BPE process on a concatenation of the source and target corpus, with 89500 BPE operations in the WMT experiment and with 45k operations in the other experiments."}, {"id": 107, "string": "This resulted in an input vocabulary of 84924 tokens and an output vocabulary of 78499 tokens in the WMT16 experiment."}, {"id": 108, "string": "The linearized constituency trees are obtained by simply replacing the POS tags in the parse trees with the corresponding word or subwords."}, {"id": 109, "string": "The output vocabulary in the bpe2tree models includes the target subwords and the tree symbols which correspond to an opening or closing of a specific phrase type."}, {"id": 110, "string": "Hyperparameters The word embedding size was set to 500/256 and the encoder and decoder sizes were set to 1024/256 (WMT16/other experiments)."}, {"id": 111, "string": "For optimization we used Adadelta (Zeiler, 2012) with minibatch size of 40."}, {"id": 112, "string": "For decoding we used beam search with a beam size of 12."}, {"id": 113, "string": "We trained the bpe2tree WMT16 model on sequences with a maximum length of 150 tokens (the average length for a linearized tree in the training set was about 50 tokens)."}, {"id": 114, "string": "It was trained for two weeks on a single Nvidia TitanX GPU."}, {"id": 115, "string": "The bpe2bpe WMT16 model was trained on sequences with a maximum length of 50 tokens, and with minibatch size of 80."}, {"id": 116, "string": "It was trained for one week on a single Nvidia TitanX GPU."}, {"id": 117, "string": "Only in the low-resource experiments we applied dropout as described in Sennrich et al."}, {"id": 118, "string": "(2016a) for Romanian-English."}, {"id": 119, "string": "Human Evaluation We performed humanevaluation on the Mechnical Turk platform."}, {"id": 120, "string": "Each sentence was evaluated using two annotators."}, {"id": 121, "string": "For each sentence, we presented the annotators with the English reference sentence, followed by the outputs of the two systems."}, {"id": 122, "string": "The German source was not shown, and the two system's outputs were shown in random order."}, {"id": 123, "string": "The annotators were instructed to answer \"Which of the two sentences, in your view, is a better portrayal of the the reference sentence.\""}, {"id": 124, "string": "They were then given 6 options: \"sent 1 is better\", \"sent 2 is better\", \"sent 1 is a little better\", \"sent 2 is a little better\", \"both sentences are equally good\", \"both sentences are equally bad\"."}, {"id": 125, "string": "We then ignore differences between \"better\" and \"a little better\"."}, {"id": 126, "string": "We count as \"strongly better\" the cases where both annotators indicated the same sentence as better, as \"weakly better\" the cases were one annotator chose a sentence and the other indicated they are both good/bad."}, {"id": 127, "string": "Other cases are treated as either \"both good\" / \"both bad\" or as disagreements."}, {"id": 128, "string": "Figure 6 : The attention weights for the string-totree translation in Figure 1 Additional Output Examples from both models, in the format of Figure 1 ."}, {"id": 129, "string": "Notice the improved translation and alignment quality in the tree-based translations, as well as the overall high structural quality of the resulting trees."}, {"id": 130, "string": "The few syntactic mistakes in these examples are attachment errors of SBAR and PP phrases, which will also challenge dedicated parsers."}], "headers": [{"section": "Introduction and Model", "n": "1", "start": 0, "end": 31}, {"section": "Experiments & Results", "n": "2", "start": 32, "end": 54}, {"section": "Analysis", "n": "3", "start": 55, "end": 97}, {"section": "Conclusions and Future Work", "n": "4", "start": 98, "end": 130}], "figures": [{"filename": "../figure/image/1192-Figure1-1.png", "caption": "Figure 1: Top - a lexicalized tree translation predicted by the bpe2tree model. Bottom - a translation for the same sentence from the bpe2bpe model. The blue lines are drawn according to the attention weights predicted by each model.", "page": 0, "bbox": {"x1": 314.88, "x2": 518.4, "y1": 471.84, "y2": 623.04}}, {"filename": "../figure/image/1192-Figure2-1.png", "caption": "Figure 2: An example of a translation from a string to a linearized, lexicalized constituency tree.", "page": 1, "bbox": {"x1": 72.0, "x2": 526.0799999999999, "y1": 66.72, "y2": 88.32}}, {"filename": "../figure/image/1192-Table1-1.png", "caption": "Table 1: BLEU results for the WMT16 experiment", "page": 2, "bbox": {"x1": 72.0, "x2": 285.12, "y1": 98.88, "y2": 168.0}}, {"filename": "../figure/image/1192-Table2-1.png", "caption": "Table 2: BLEU results for the low-resource experiments (News Commentary v8)", "page": 2, "bbox": {"x1": 308.64, "x2": 519.36, "y1": 61.44, "y2": 223.2}}, {"filename": "../figure/image/1192-Figure6-1.png", "caption": "Figure 6: The attention weights for the string-totree translation in Figure 1", "page": 7, "bbox": {"x1": 341.76, "x2": 488.15999999999997, "y1": 155.51999999999998, "y2": 444.96}}, {"filename": "../figure/image/1192-Table4-1.png", "caption": "Table 4: Translation examples from newstest2015. The underlines correspond to the source word attended by the first opening bracket (these are consistently the main verbs or structural markers) and the target words this source word was most strongly aligned to. See the supplementary material for an attention weight matrix example when predicting a tree (Figure 6) and additional output examples.", "page": 3, "bbox": {"x1": 74.88, "x2": 522.24, "y1": 399.84, "y2": 696.0}}, {"filename": "../figure/image/1192-Figure4-1.png", "caption": "Figure 4: Average distortion score on the dev-set during different training stages", "page": 3, "bbox": {"x1": 233.76, "x2": 367.2, "y1": 68.16, "y2": 189.6}}, {"filename": "../figure/image/1192-Figure5-1.png", "caption": "Figure 5: Amount of English relative pronouns in newstest2015 translations", "page": 3, "bbox": {"x1": 401.76, "x2": 518.4, "y1": 76.8, "y2": 188.64}}, {"filename": "../figure/image/1192-Figure3-1.png", "caption": "Figure 3: newstest2015 DE-EN translations binned by distortion amount", "page": 3, "bbox": {"x1": 78.24, "x2": 215.04, "y1": 76.8, "y2": 189.12}}, {"filename": "../figure/image/1192-Table3-1.png", "caption": "Table 3: Top dev-set GHKM Rules with reordering. Numbers: rule counts. Bolded: reordering rules.", "page": 3, "bbox": {"x1": 72.96, "x2": 525.12, "y1": 260.15999999999997, "y2": 360.96}}]}